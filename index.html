<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»™ä½ çš„æ–°å¹´ç¤¼ç‰©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* ä¿æŒåŸæœ‰çš„æ‰€æœ‰CSSæ ·å¼ä¸å˜ */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial Rounded MT Bold', 'Microsoft YaHei', sans-serif; }
        body { overflow: hidden; background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%); }
        /* ... å…¶ä»–æ‰€æœ‰CSSæ ·å¼ä¿æŒä¸å˜ ... */
    </style>
</head>
<body>
    <!-- éŸ³ä¹æç¤ºå±‚ -->
    <div id="music-hint" style="display:none;">
        <div class="hint-box">
            <i class="fas fa-music"></i>
            <h2>ğŸµ å¼€å¯éŸ³ä¹ä½“éªŒ</h2>
            <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å¼€å¯èƒŒæ™¯éŸ³ä¹</p>
            <button class="hint-btn" id="enable-music-btn">
                å¼€å¯éŸ³ä¹å¹¶è¿›å…¥
            </button>
        </div>
    </div>

    <!-- ç¬¬ä¸€å¹•ï¼šç¤¼ç‰©é€‰æ‹© -->
    <div id="scene-1">
        <div class="gift-container">
            <div class="gift-emoji">ğŸ</div>
            <div class="gift-text">ç»™<span>æœ±å¥•éœ</span>çš„æ–°å¹´ç¤¼ç‰©ï¼Œæ˜¯å¦æ¥æ”¶ï¼Ÿ</div>
            <div class="buttons">
                <button class="btn btn-accept" id="accept-btn">æ¥ å— ğŸ’</button>
                <button class="btn btn-reject" id="reject-btn">æ‹’ ç» âœ–</button>
            </div>
        </div>
    </div>

    <!-- ç¬¬äºŒå¹•ï¼šä¿¡ä»¶é¡µé¢ -->
    <div id="scene-2">
        <canvas id="snow-canvas"></canvas>
        <canvas id="hearts-canvas"></canvas>
        
        <div class="letter-container">
            <div class="letter-header">
                <div class="ribbon">ğŸ€</div>
                <div class="to-name">to æœ±å¥•éœ</div>
                <div class="decoration-line"></div>
            </div>
            
            <div class="letter-content">
å¸Œæœ›æˆ‘ä»¬åœ¨è¿™äº›å¹´èƒ½å˜å¾—æ›´å¥½
            </div>
            
            <div class="letter-footer">
                <div class="from-name">ä¸€ä¸€</div>
                <div class="date">2026å¹´1æœˆ1æ—¥</div>
            </div>
        </div>
    </div>

    <!-- éŸ³ä¹æ§åˆ¶ -->
    <div class="music-control" id="music-control">
        <i class="fas fa-play"></i>
    </div>

    <!-- èƒŒæ™¯éŸ³ä¹ - å¤šæºå¤‡ç”¨ -->
    <audio id="bg-music" loop preload="auto">
        <source src="https://cdn.freesound.org/previews/324/324142_4948336-lq.mp3" type="audio/mpeg">
        <source src="http://commondatastorage.googleapis.com/codeskulptor-assets/Epoq-Lepidoptera.ogg" type="audio/ogg">
        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾
    </audio>

    <script>
        // ========== éŸ³ä¹æ’­æ”¾ç³»ç»Ÿ ==========
        const bgMusic = document.getElementById('bg-music');
        const musicControl = document.getElementById('music-control');
        const musicIcon = musicControl.querySelector('i');
        const musicHint = document.getElementById('music-hint');
        const enableMusicBtn = document.getElementById('enable-music-btn');
        
        let musicPlaying = false;
        let musicInitialized = false;
        
        // å°è¯•æ’­æ”¾éŸ³ä¹
        function tryPlayMusic() {
            if (musicInitialized) return;
            
            bgMusic.volume = 0.3;
            
            // æ–¹æ³•1ï¼šç›´æ¥æ’­æ”¾
            const playPromise = bgMusic.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    // æˆåŠŸï¼
                    musicPlaying = true;
                    musicInitialized = true;
                    musicIcon.className = 'fas fa-pause';
                    console.log('éŸ³ä¹è‡ªåŠ¨æ’­æ”¾æˆåŠŸ');
                }).catch(error => {
                    console.log('è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢ï¼Œæ˜¾ç¤ºæç¤º');
                    showMusicHint();
                });
            }
        }
        
        // æ˜¾ç¤ºéŸ³ä¹æç¤º
        function showMusicHint() {
            musicHint.style.display = 'flex';
            
            enableMusicBtn.onclick = function() {
                bgMusic.play().then(() => {
                    musicPlaying = true;
                    musicInitialized = true;
                    musicIcon.className = 'fas fa-pause';
                    musicHint.style.display = 'none';
                    localStorage.setItem('musicEnabled', 'true');
                });
            };
            
            // 5ç§’åè‡ªåŠ¨éšè—æç¤ºï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨ç‚¹å‡»éŸ³ä¹æŒ‰é’®
            setTimeout(() => {
                if (!musicPlaying) {
                    musicHint.style.opacity = '0';
                    setTimeout(() => {
                        musicHint.style.display = 'none';
                    }, 500);
                }
            }, 5000);
        }
        
        // é¡µé¢åŠ è½½åå°è¯•æ’­æ”¾
        window.addEventListener('load', () => {
            setTimeout(tryPlayMusic, 300);
            
            // å…¨å±€ç‚¹å‡»æ—¶ä¹Ÿå°è¯•
            document.addEventListener('click', () => {
                if (!musicInitialized) {
                    tryPlayMusic();
                }
            }, { once: true });
        });
        
        // éŸ³ä¹æ§åˆ¶æŒ‰é’®
        musicControl.addEventListener('click', (e) => {
            e.stopPropagation();
            
            if (!musicInitialized) {
                bgMusic.play().then(() => {
                    musicPlaying = true;
                    musicInitialized = true;
                    musicIcon.className = 'fas fa-pause';
                });
                return;
            }
            
            if (musicPlaying) {
                bgMusic.pause();
                musicIcon.className = 'fas fa-play';
            } else {
                bgMusic.play();
                musicIcon.className = 'fas fa-pause';
            }
            musicPlaying = !musicPlaying;
        });
        
        // ========== æ‹’ç»æŒ‰é’®é€ƒè·‘æ•ˆæœ ==========
        let rejectRunning = false;
        let rejectInterval = null;
        let speed = 5;
        
        function moveRejectButton() {
            if (!rejectRunning) return;
            
            const viewportWidth = window.innerWidth;
            const viewportHeight = window.innerHeight;
            const btnWidth = rejectBtn.offsetWidth;
            const btnHeight = rejectBtn.offsetHeight;
            
            let newX = Math.random() * (viewportWidth - btnWidth);
            let newY = Math.random() * (viewportHeight - btnHeight);
            
            rejectBtn.style.transition = `all ${0.3 + Math.random() * 0.4}s cubic-bezier(0.34, 1.56, 0.64, 1)`;
            rejectBtn.style.position = 'fixed';
            rejectBtn.style.left = newX + 'px';
            rejectBtn.style.top = newY + 'px';
            rejectBtn.style.transform = `rotate(${Math.random() * 20 - 10}deg)`;
            
            speed = Math.min(speed + 0.2, 15);
        }
        
        rejectBtn.addEventListener('click', () => {
            if (!rejectRunning) {
                rejectRunning = true;
                moveRejectButton();
                rejectInterval = setInterval(moveRejectButton, 800 - speed * 30);
                rejectBtn.innerHTML = 'æŠ“ä¸åˆ°æˆ‘ ğŸ˜œ';
                rejectBtn.style.background = 'linear-gradient(135deg, #ff4757, #ff3838)';
            }
        });
        
        rejectBtn.addEventListener('mouseover', () => {
            if (!rejectRunning) {
                moveRejectButton();
            }
        });
        
        // ========== æ¥å—æŒ‰é’®ç‚¹å‡» ==========
        acceptBtn.addEventListener('click', () => {
            if (rejectInterval) {
                clearInterval(rejectInterval);
                rejectRunning = false;
            }
            
            acceptBtn.innerHTML = 'æ¥æ”¶ä¸­ ğŸ’–';
            acceptBtn.style.background = 'linear-gradient(135deg, #00d2ff, #3a7bd5)';
            
            setTimeout(() => {
                scene1.style.opacity = '0';
                scene1.style.transform = 'scale(1.1)';
                
                setTimeout(() => {
                    scene1.style.display = 'none';
                    scene2.style.display = 'flex';
                    
                    setTimeout(() => {
                        scene2.style.opacity = '1';
                        
                        // ç¡®ä¿éŸ³ä¹æ’­æ”¾
                        if (!musicPlaying && musicInitialized) {
                            bgMusic.play().then(() => {
                                musicPlaying = true;
                                musicIcon.className = 'fas fa-pause';
                            });
                        }
                        
                        // å¯åŠ¨ç‰¹æ•ˆ
                        initSnow();
                        initHearts();
                    }, 100);
                }, 600);
            }, 300);
        });
        
        // ========== ç‰¹æ•ˆç³»ç»Ÿ ==========
        function initSnow() {
            const canvas = document.getElementById('snow-canvas');
            const ctx = canvas.getContext('2d');
            let snowflakes = [];
            
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            
            class Snowflake {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = Math.random() * canvas.height - canvas.height;
                    this.size = Math.random() * 5 + 2;
                    this.speed = Math.random() * 1.2 + 0.5;
                    this.opacity = Math.random() * 0.6 + 0.2;
                    this.wind = Math.random() * 0.8 - 0.4;
                    this.swing = Math.random() * 0.05;
                    this.swingOffset = Math.random() * Math.PI * 2;
                }
                
                update() {
                    this.y += this.speed;
                    this.x += this.wind + Math.sin(Date.now() * 0.001 + this.swingOffset) * this.swing;
                    
                    if (this.y > canvas.height) {
                        this.y = -10;
                        this.x = Math.random() * canvas.width;
                    }
                    if (this.x > canvas.width) this.x = 0;
                    if (this.x < 0) this.x = canvas.width;
                }
                
                draw() {
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
                    ctx.fill();
                }
            }
            
            function createSnowflakes() {
                snowflakes = [];
                for (let i = 0; i < 200; i++) {
                    snowflakes.push(new Snowflake());
                }
            }
            
            function animateSnow() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                snowflakes.forEach(flake => {
                    flake.update();
                    flake.draw();
                });
                requestAnimationFrame(animateSnow);
            }
            
            resizeCanvas();
            createSnowflakes();
            animateSnow();
            
            window.addEventListener('resize', () => {
                resizeCanvas();
                createSnowflakes();
            });
        }
        
        function initHearts() {
            const canvas = document.getElementById('hearts-canvas');
            const ctx = canvas.getContext('2d');
            let hearts = [];
            
            function resizeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }
            
            class Heart {
                constructor() {
                    this.x = Math.random() * canvas.width;
                    this.y = canvas.height + 20;
                    this.size = Math.random() * 12 + 8;
                    this.speed = Math.random() * 1.5 + 0.5;
                    this.opacity = Math.random() * 0.5 + 0.2;
                    this.color = `rgba(255, ${Math.floor(Math.random() * 80 + 100)}, ${Math.floor(Math.random() * 120 + 180)}, ${this.opacity})`;
                    this.wave = Math.random() * 0.8;
                    this.waveSpeed = Math.random() * 0.03 + 0.01;
                    this.waveOffset = Math.random() * Math.PI * 2;
                    this.rotation = Math.random() * Math.PI * 2;
                    this.rotateSpeed = Math.random() * 0.02 - 0.01;
                }
                
                update() {
                    this.y -= this.speed;
                    this.x += Math.sin(Date.now() * this.waveSpeed + this.waveOffset) * this.wave;
                    this.rotation += this.rotateSpeed;
                    
                    if (this.y < -30) {
                        this.y = canvas.height + 20;
                        this.x = Math.random() * canvas.width;
                    }
                }
                
                draw() {
                    ctx.save();
                    ctx.globalAlpha = this.opacity;
                    ctx.fillStyle = this.color;
                    ctx.translate(this.x, this.y);
                    ctx.rotate(this.rotation);
                    
                    ctx.beginPath();
                    const topCurveHeight = this.size * 0.3;
                    ctx.moveTo(0, topCurveHeight);
                    
                    ctx.bezierCurveTo(0, 0, -this.size, 0, -this.size, topCurveHeight);
                    ctx.bezierCurveTo(-this.size, this.size * 0.6, 0, this.size * 0.9, 0, this.size);
                    ctx.bezierCurveTo(0, this.size * 0.9, this.size, this.size * 0.6, this.size, topCurveHeight);
                    ctx.bezierCurveTo(this.size, 0, 0, 0, 0, topCurveHeight);
                    
                    ctx.closePath();
                    ctx.fill();
                    ctx.restore();
                }
            }
            
            function createHearts() {
                hearts = [];
                for (let i = 0; i < 40; i++) {
                    hearts.push(new Heart());
                }
            }
            
            function animateHearts() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                hearts.forEach(heart => {
                    heart.update();
                    heart.draw();
                });
                requestAnimationFrame(animateHearts);
            }
            
            resizeCanvas();
            createHearts();
            animateHearts();
            
            window.addEventListener('resize', () => {
                resizeCanvas();
                createHearts();
            });
        }
    </script>
</body>
</html>
